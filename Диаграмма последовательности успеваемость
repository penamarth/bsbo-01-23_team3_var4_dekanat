@startuml

actor User as user
participant "UI" as ui
participant "DeanOfficeController" as controller
participant "IAcademicRecordsService" as ar_service
participant "AcademicRecordsService" as ar_service_impl
participant "IAcademicRecordsRepository" as ar_repo
participant "AcademicRecordsRepository" as ar_repo_impl
participant "DbContext" as db

user -> ui : main()\n// Запуск приложения
ui -> controller : updateAcademicPerformance()\n// Начало процесса обновления оценок

controller -> ar_service : addGrade()\n// Запрос на добавление новой оценки
activate ar_service
ar_service -> ar_service_impl : addGrade()\n// Вызов реализации сервиса
activate ar_service_impl

ar_service_impl -> ar_repo : add()\n// Сохранение в базу данных
activate ar_repo
ar_repo -> ar_repo_impl : add()\n// Вызов реализации репозитория
activate ar_repo_impl
ar_repo_impl -> db : \n// SQL запрос INSERT
ar_repo_impl --> ar_repo : AcademicRecord\n// Подтверждение создания записи
deactivate ar_repo_impl
ar_repo --> ar_service_impl : AcademicRecord\n// Возврат созданного объекта
deactivate ar_repo
ar_service_impl --> ar_service : AcademicRecord\n// Подтверждение успешного добавления
deactivate ar_service_impl
ar_service --> controller : AcademicRecord\n// Оценка добавлена в систему
deactivate ar_service

controller -> ar_service : calculateGPA()\n// Запрос расчета среднего балла
activate ar_service
ar_service -> ar_service_impl : calculateGPA()\n// Вызов логики расчета
activate ar_service_impl

ar_service_impl -> ar_repo : getAll()\n// Получение всех оценок студента
activate ar_repo
ar_repo -> ar_repo_impl : getAll()\n// Запрос к базе данных
activate ar_repo_impl
ar_repo_impl -> db : \n// SQL запрос SELECT
ar_repo_impl --> ar_repo : List<AcademicRecord>\n// Все академические записи
deactivate ar_repo_impl
ar_repo --> ar_service_impl : List<AcademicRecord>\n// Передача данных для расчета
deactivate ar_repo
ar_service_impl --> ar_service : double\n// Результат вычисления GPA
deactivate ar_service_impl
ar_service --> controller : double\n// Средний балл рассчитан
deactivate ar_service

controller -> ar_service : getTranscript()\n// Запрос академической ведомости
activate ar_service
ar_service -> ar_service_impl : getTranscript()\n// Формирование отчета
activate ar_service_impl

ar_service_impl -> ar_repo : getAll()\n// Получение полной истории оценок
activate ar_repo
ar_repo -> ar_repo_impl : getAll()\n// Запрос всех записей
activate ar_repo_impl
ar_repo_impl -> db : \n// SQL запрос с фильтрацией
ar_repo_impl --> ar_repo : List<AcademicRecord>\n// Полный список оценок
deactivate ar_repo_impl
ar_repo --> ar_service_impl : List<AcademicRecord>\n// Данные для ведомости
deactivate ar_repo
ar_service_impl --> ar_service : List<AcademicRecord>\n// Сформированная ведомость
deactivate ar_service_impl
ar_service --> controller : List<AcademicRecord>\n// Академическая история готова
deactivate ar_service

controller --> ui : \n// Процесс завершен успешно
ui --> user : \n// Результаты отображены пользователю

@enduml
