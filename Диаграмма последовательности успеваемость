@startuml

actor "Преподаватель" as Teacher
participant "DeanOfficeController" as DO
participant "IStudentsService" as ISS
participant "IAcademicRecordsService" as IARS
participant "IAcademicRecordsRepository" as IARR
participant "DbContext" as DB

Teacher -> DO: updateAcademicPerformance(groupId, subject, evaluations)
activate DO

loop Для каждого evaluation в evaluations
    DO -> ISS: getStudentInfo(evaluation.studentId)
    activate ISS
    ISS -> ISS: [внутренняя логика получения студента]
    ISS --> DO: studentInfo
    deactivate ISS
    
    DO -> DO: определитьОценку(evaluation)
    
    DO -> IARS: addGrade(evaluation.studentId, subject, evaluation.grade, evaluation.date)
    activate IARS
    IARS -> IARR: add(new AcademicRecord)
    activate IARR
    IARR -> DB: сохранить AcademicRecord
    activate DB
    note right DB: Создается новая запись\nсвязь с Student через studentId
    DB --> IARR: запись создана
    deactivate DB
    IARR --> IARS: запись успешно добавлена
    deactivate IARR
    
    IARS -> ISS: updateStudentAcademicRecords(evaluation.studentId)
    activate ISS
    ISS -> ISS: [внутренняя логика обновления записей]
    ISS --> IARS: обновлено
    deactivate ISS
    
    IARS --> DO: gradeAdded
    deactivate IARS
end


DO --> Teacher: Оценки выставлены успешно
deactivate DO

@enduml
